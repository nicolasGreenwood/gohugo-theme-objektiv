{{ define "main" }}
<r-grid>
    <r-cell span="2" span-s="row" class="padding-y3">
        <p class="serif large">{{ .Site.Params.description }}</p>
        <a href='{{ "about/" | relURL }}'>{{ .Site.Params.description_link_text }}</a>
    </r-cell>
</r-grid>

<section>
    <r-grid>
        <r-cell span="row">
            <h2 class="base-font-size bold">Latest</h2>
        </r-cell>
        {{ $latest_content := where .Site.RegularPages "Section" "in"
        .Site.MainSections }} {{ range $latest_content.ByDate.Reverse.Limit 3 }}
        <r-cell span="2" span-s="row">
            <article>
                <img src="{{ .Params.cover | relURL }}" class="cover-image" alt="thumbnail" />
                <h3 class="base-font-size bold margin0">
                    <a href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
                </h3>
                <p class="opacity6 margin0">{{ .Summary }}</p>
                <p class="xsmall opacity6">
                    <a href="{{ .CurrentSection.RelPermalink }}"
                        >{{ .CurrentSection.LinkTitle }}</a
                    >
                    Â·
                    <time>{{ .Date | time.Format ":date_medium" }}</time>
                </p>
            </article>
        </r-cell>
        {{ end }}
    </r-grid>
</section>
<hr />

{{ range $i,$p := .Site.Sections.ByWeight }}
<section class="padding-y1">
    <r-grid {{ if not (modBool $i 2) }} class="reverse-col-dir" {{end}}>
        <r-cell span="2" span-s="row">
            <img
                src="{{ .Params.Cover | relURL }}"
                width="100%"
                alt="journal thumnail"
            />
        </r-cell>
        <r-cell span="2" span-s="row">
            <div class="flex-col-between">
                <h2 class="h1 xlarge margin0">{{ .Title }}</h2>
                <div>
                    <p>{{ .Summary }}</p>
                    <a class="bold" href="{{ .RelPermalink }}">{{ .Params.invite_link_text }}</a>
                </div>
            </div>
        </r-cell>
    </r-grid>
</section>
{{ end }}
<hr>
<section>
    <r-grid>
        <r-cell span="2-3" span-s="row" class="center padding-y2">
            <h3>Subscribe</h3>
            <p class="serif large">{{ .Site.Params.subscribe_promo_text }}</p>
            <form 
                class="flex-col-center embeddable-buttondown-form" 
                action="https://buttondown.com/api/emails/embed-subscribe/{{ .Site.Params.buttondown_username }}"
                method="post"
                referrerpolicy="unsafe-url"
            >
            {{ if not .Site.Params.buttondown_username }}
                <p class="xsmall red">*Subscription form functionality coming soon</p>
            {{ end }}
                <label for="bd-email" class="xsmall bold">Your Email Address:</label>
                <input type="email" name="email" id="bd-email" placeholder="your@email.com"{{ if not .Site.Params.buttondown_username }} disabled{{ end }}>
                <button class="block bg-theme" type="submit"{{ if not .Site.Params.buttondown_username }} disabled{{ end }}>Subscribe</button>
                <p class="xsmall opacity6">
                    <a href="https://buttondown.com/refer/{{ .Site.Params.buttondown_username }}" target="_blank">
                      Powered by Buttondown.
                    </a>
                  </p>
            </form>
        </r-cell>
    </r-grid>
</section>
{{ end }}
